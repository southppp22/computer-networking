세그먼트: 트랜스포트 계층 패킷

### 다중화와 역다중화

TCP와 TDP에서 공통적으로 제공하는 기능

- 다중화: 출발지 호스트에서 소켓으로부터 데이터를 모으고, 이에 대한 세그먼트를 생성하기 위해 각 데이터에 헤더 정보로 캡슐화하고, 그 세그먼트들을 네트워크 계층으로 전달하는 작업
- 역다중화: 트랜스포트 계층 세그먼트의 데이터를 올바른 소켓으로 전달하는 작업

#### 비연결형 다중화와 역다중화

UDP: 소켓과 소켓 사이의 1:1 매핑 개념없음. 출발지 포트번호가 달라도 목적지 포트 번호가 같으면 같은 소켓을 통해 같은 프로세스로 향한다.

포트번호만 보고 식별함

- 출발지 포트 번호
- 목적지 포트 번호

#### 연결지향형 다중화와 역다중화

TCP 소켓은 4개 요소의 집합에 의해 식별된다.

- 출발지 IP 주소
- 출발지 포트 번호
- 목적지 IP 주소
- 목적지 포트 번호

## 비연결형 트랜스포트: UDP

#### UDP 세그먼트 구조

- Header (필드당 2바이트)
  - 출발지 포트 번호
  - 목적지 포트 번호
  - 길이
  - 체크섬
- 애플리케이션 데이터 (메시지)

#### UDP 체크섬

오류 검출을 위한 것. UDP는 오류 검사를 제공하지만, 오류를 회복하기 위한 어떤 일도 하지 않는다.
손상된 세그먼트를 버리거나 경고

## 신뢰적인 데이터 전송의 원리

#### 신뢰적인 데이터 전송 프로토콜의 구축

**rdt 1.0 - 완벽하게 신뢰적인 채널상에서의 신뢰적인 데이터 전송**

- 오류 X
- 손실 X

송신측은 패킷을 보내고 수신측은 받음.
수신측이 송신측에게 어떤 피드백도 제공하지 않음

**rdt 2.0 - 비트 오류가 있는 채널상에서의 신뢰적 데이터 전송**

- 오류 O
- 손실 X

- 체크섬을 필드를 사용해 오류 검출.
- 수신측은 송신측에게 피드백 제공. 긍정 확인응답(ACK), 부정 확인응답(NAK)
- 송신측은 NAK를 받으면 데이터 재전송

**rdt 2.1**
ACK, ANK 패킷에서 오류가 있을 수 있다.

수신측에서 재전송된 메시지인지 새로운 메시지인지 모르기 때문에 순서 번호(sequence number) 삽입
수신측은 중복이든 아니든 무조건 피드백을 보냄.

**rdt 2.2**
NAK 빼고 ACK만 가지고 동작시킴
에러 받으면 ACK와 제대로 받은 마지막 시퀀스 넘버를 보냄

송신자는 제대로 된 ACK를 확인하지 못 하면 재전송한다.

**rdt 3.0 - 비트 오류와 손실 있는 채널상에서의 신뢰적인 데이터 전송**

- 오류 O
- 손실 O

타이머를 추가해 ACK를 기다리는 시간을 제한하고 타이머가 끝나기 전에 ACK를 받지 못하면 패킷을 재전송

- 무손실 동작
- 패킷 손실
  - 시간 설정해놓고 그 안에 응답이 안 오면 재전송
- ACK 손실
  - 중복을 받았기 때문에 버리고 응답 보냄
- 조급한 타임아웃
  - 손실 아닌데 타임아웃으로 재전송됨. 응답 받으면 다음 패킷 전송
